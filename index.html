<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER MOLE | äº’å‹•æ•¸ä½æ‰“åœ°é¼ </title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --neon-green: #39ff14;
            --mole-brown: #a0522d;
            --hole-dark: #1a1a1a;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: #051a05;
            /* ç§‘æŠ€è‰åœ°ç¶²æ ¼ */
            background-image: 
                linear-gradient(rgba(57, 255, 20, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(57, 255, 20, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* --- èƒŒæ™¯åœ°é¼ å‹•ç•«å€ --- */
        .bg-elements {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .mole-bg {
            position: absolute;
            width: 60px; height: 60px;
            background: var(--mole-brown);
            border-radius: 50% 50% 0 0;
            bottom: -70px; /* è—èµ·ä¾† */
            border: 3px solid var(--neon-green);
            box-shadow: 0 0 15px var(--neon-green);
        }

        /* åœ°é¼ æ¢é ­å‹•ç•« */
        @keyframes popUp {
            0%, 100% { bottom: -70px; }
            20%, 80% { bottom: 10px; }
        }

        /* ç•«å‡ºåœ°é¼ è‡‰éƒ¨ (ç”¨ CSS ç•«ä¸éœ€è¦åœ–ç‰‡) */
        .mole-bg::before {
            content: "ğŸ‘€";
            position: absolute; top: 10px; left: 15px; font-size: 20px;
        }
        .mole-bg::after {
            content: "é¼»";
            position: absolute; top: 30px; left: 22px; font-size: 10px; color: pink;
        }

        /* åœ°é¼ å‡ºç¾ä½ç½®èˆ‡æ™‚é–“ */
        .m1 { left: 15%; animation: popUp 4s infinite 1s; }
        .m2 { left: 45%; animation: popUp 6s infinite 3s; }
        .m3 { left: 80%; animation: popUp 5s infinite 2s; }

        /* --- ä¸»é¢æ¿ --- */
        .container {
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid var(--neon-green);
            box-shadow: 0 0 30px rgba(57, 255, 20, 0.4);
            border-radius: 30px;
            padding: 40px;
            width: 400px;
            text-align: center;
            z-index: 10;
        }

        h1 {
            color: var(--neon-green);
            text-shadow: 0 0 15px var(--neon-green);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .score-display {
            font-size: 5rem;
            color: #fff;
            text-shadow: 0 0 20px var(--neon-green);
            margin: 20px 0;
            font-family: monospace;
        }

        button {
            background: var(--neon-green);
            border: none;
            color: black;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: 0.3s;
        }

        button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px var(--neon-green);
        }

        .rank-list {
            margin-top: 30px;
            text-align: left;
            color: #ccc;
        }
    </style>
</head>
<body>

<div class="bg-elements">
    <div class="mole-bg m1"></div>
    <div class="mole-bg m2"></div>
    <div class="mole-bg m3"></div>
</div>

<div class="container">
    <h1>CYBER MOLE</h1>
    <p id="status" style="color: #666;">ç­‰å¾…é€£æ¥æ‰“åœ°é¼ æ©Ÿ...</p>
    
    <div class="score-display" id="liveScore">00</div>
    
    <button id="connectBtn">âš¡ å•Ÿå‹•ç³»çµ±é€£ç·š</button>

    <div class="rank-list">
        <p style="border-bottom: 1px solid var(--neon-green); padding-bottom: 5px;">TOP RANKING</p>
        <div id="rankBody">è¼‰å…¥æ’è¡Œæ¦œä¸­...</div>
    </div>
</div>

<script>
    // --- é€™è£¡æ²¿ç”¨ä¹‹å‰çš„ Firebase èˆ‡ Web Serial é‚è¼¯ ---
    let port;
    const connectBtn = document.getElementById('connectBtn');
    const scoreText = document.getElementById('liveScore');
    const statusTag = document.getElementById('status');

    connectBtn.addEventListener('click', async () => {
        try {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });
            statusTag.innerText = "ç³»çµ±å·²ä¸Šç·š ONLINE";
            statusTag.style.color = "var(--neon-green)";
            connectBtn.style.display = 'none';
            readData();
        } catch (e) { alert("è«‹ä½¿ç”¨ Chrome ç€è¦½å™¨ä¸¦é–‹å•Ÿ USB æ¬Šé™"); }
    });

    async function readData() {
        const textDecoder = new TextDecoderStream();
        port.readable.pipeTo(textDecoder.writable);
        const reader = textDecoder.readable.getReader();
        while (true) {
            const { value, done } = await reader.read();
            if (value) {
                if (value.includes("LIVE_SCORE:")) {
                    scoreText.innerText = value.split(":")[1].trim().padStart(2, '0');
                }
                if (value.includes("GAME_OVER_SCORE:")) {
                    alert("éŠæˆ²çµæŸï¼åˆ†æ•¸ï¼š" + value.split(":")[1]);
                }
            }
            if (done) break;
        }
    }
</script>

</body>
</html>
