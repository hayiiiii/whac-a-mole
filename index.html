<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>PIXEL MOLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; background-color: #5d8a31;
            font-family: 'Press Start 2P', cursive;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
        }
        .mole-grid {
            position: fixed; width: 100vw; height: 100vh;
            display: grid; grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr); z-index: 1;
        }
        .hole-container { position: relative; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .pixel-hole { width: 120px; height: 30px; background: #2b1d0e; border-radius: 50%; position: absolute; bottom: 20%; z-index: 2; }
        .pixel-mole { 
            width: 60px; height: 70px; background: #a0522d; 
            position: absolute; bottom: -80px; z-index: 3;
            transition: transform 0.3s; border-radius: 30px 30px 0 0;
            border: 4px solid #000;
        }
        .is-active { transform: translateY(-90px); }
        .ui-panel {
            position: relative; z-index: 10; background: #222; border: 4px solid #fff;
            padding: 20px; text-align: center; color: #fff; width: 300px;
        }
        button { font-family: 'Press Start 2P', cursive; padding: 10px; width: 100%; cursor: pointer; }
    </style>
</head>
<body>

<div class="mole-grid" id="grid"></div>

<div class="ui-panel">
    <div id="status" style="font-size: 10px; margin-bottom: 10px;">ARDUINO OFFLINE</div>
    <div id="liveScore" style="font-size: 40px; color: #0f0; margin: 10px;">00</div>
    <button id="connectBtn">CONNECT</button>
</div>

<script>
    // 動態生成 9 個洞
    const grid = document.getElementById('grid');
    for(let i=0; i<9; i++) {
        grid.innerHTML += `<div class="hole-container"><div class="pixel-hole"></div><div class="pixel-mole" id="mole-${i}"></div></div>`;
    }

    // 隨機動畫
    function pop() {
        const moles = document.querySelectorAll('.pixel-mole');
        moles.forEach(m => m.classList.remove('is-active'));
        moles[Math.floor(Math.random()*9)].classList.add('is-active');
        setTimeout(pop, 2000);
    }
    pop();

    // 連線邏輯
    let port;
    document.getElementById('connectBtn').onclick = async () => {
        try {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });
            document.getElementById('status').innerText = "ONLINE";
            read();
        } catch (e) { alert("連線失敗"); }
    };

    async function read() {
        const reader = port.readable.pipeThrough(new TextDecoderStream()).getReader();
        while (true) {
            const { value, done } = await reader.read();
            if (value && value.includes("LIVE_SCORE:")) {
                document.getElementById('liveScore').innerText = value.split(":")[1].trim().padStart(2, '0');
            }
            if (done) break;
        }
    }
</script>
</body>
</html>
